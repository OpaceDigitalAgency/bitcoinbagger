"use strict";(()=>{var e={};e.id=474,e.ids=[474],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},295:e=>{e.exports=import("cheerio")},498:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>l,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h});var i=r(9303),n=r(8716),s=r(670),c=r(9706),o=e([c]);c=(o.then?(await o)():o)[0];let u=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/etfs/route",pathname:"/api/etfs",filename:"route",bundlePath:"app/api/etfs/route"},resolvedPagePath:"/Users/davidbryan/Dropbox/Opace-Sales-Marketing/BitcoinBagger/src/app/api/etfs/route.ts",nextConfigOutput:"",userland:c}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:p}=u,f="/api/etfs/route";function l(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}a()}catch(e){a(e)}})},9706:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>c,dynamic:()=>B});var i=r(7070),n=r(295),s=e([n]);n=(s.then?(await s)():s)[0];let B="force-dynamic";async function c(e){try{let e=await o();if(!e)return i.NextResponse.json({error:"Unable to fetch Bitcoin price. Please try again later."},{status:503});let t=await l();if(!t||0===t.length)return i.NextResponse.json({error:"Unable to fetch ETF holdings data. Please try again later."},{status:503});let r=await g(t,e);return i.NextResponse.json(r,{headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600"}})}catch(e){return console.error("Error fetching ETF data:",e),i.NextResponse.json({error:"Unable to fetch live ETF data. Please try again later."},{status:503})}}async function o(){try{let e=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd",{next:{revalidate:300},headers:{"User-Agent":"BitcoinBagger/1.0"}});if(!e.ok)throw Error(`CoinGecko API error: ${e.status}`);let t=await e.json();return t.bitcoin?.usd||null}catch(e){return console.error("Failed to fetch Bitcoin price:",e),null}}async function l(){try{for(let e of[{url:"https://bitbo.io/",parser:u},{url:"https://bitcointreasuries.net/",parser:d}])try{let t=await fetch(e.url,{headers:{"User-Agent":"BitcoinBagger/1.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"},next:{revalidate:3600}});if(t.ok){let r=await t.text(),a=e.parser(r);if(a&&a.length>0)return a}}catch(t){console.warn(`Failed to fetch from ${e.url}:`,t);continue}return console.warn("Using estimated ETF data - live scraping failed"),[{ticker:"IBIT",name:"iShares Bitcoin Trust",btcHeld:875e3,sharesOutstanding:245e7},{ticker:"FBTC",name:"Fidelity Wise Origin Bitcoin Trust",btcHeld:188e3,sharesOutstanding:226e6},{ticker:"GBTC",name:"Grayscale Bitcoin Trust",btcHeld:367e3,sharesOutstanding:692e6},{ticker:"BITB",name:"Bitwise Bitcoin ETF",btcHeld:45500,sharesOutstanding:14e7},{ticker:"ARKB",name:"ARK 21Shares Bitcoin ETF",btcHeld:52800,sharesOutstanding:104e6}]}catch(e){return console.error("Failed to fetch ETF holdings data:",e),null}}function u(e){let t=n.load(e),r=[];if(t("table").each((e,a)=>{t(a).find("tbody tr, tr").each((e,a)=>{let i=t(a).find("td, th");if(i.length>=3){let e=i.eq(0).text().trim(),t=h(e);if(t){let e=i.eq(1).text().trim(),a=f(e),n=i.eq(2).text().trim(),s=m(n);a>0&&r.push({ticker:t,name:p(t),btcHeld:a,sharesOutstanding:s})}}})}),0===r.length)for(let e of["IBIT","FBTC","GBTC","BITB","ARKB","BTC","HODL"]){let a=function(e,t){let r=e(`*:contains("${t}")`).first();if(r.length>0){let e=r.closest("tr").find("td");if(e.length>=3){let r=f(e.eq(1).text().trim()),a=m(e.eq(2).text().trim());if(r>0)return{ticker:t,name:p(t),btcHeld:r,sharesOutstanding:a}}}return null}(t,e);a&&r.push(a)}return r}function d(e){let t=n.load(e),r=[];return t("table tbody tr").each((e,a)=>{let i=t(a).find("td");if(i.length>=2){let e=i.eq(0).text().trim().toLowerCase();if(e.includes("etf")||e.includes("trust")||e.includes("shares")){let e=h(i.eq(0).text().trim()),t=i.eq(1).text().trim(),a=f(t);e&&a>0&&r.push({ticker:e,name:p(e),btcHeld:a,sharesOutstanding:0})}}}),r}function h(e){let t=e.match(/\(([A-Z]{3,5})\)/)||e.match(/^([A-Z]{3,5})$/);return t?t[1]:null}function p(e){return({IBIT:"iShares Bitcoin Trust",FBTC:"Fidelity Wise Origin Bitcoin Trust",GBTC:"Grayscale Bitcoin Trust",BITB:"Bitwise Bitcoin ETF",ARKB:"ARK 21Shares Bitcoin ETF",BTC:"VanEck Bitcoin Trust",HODL:"VanEck Bitcoin Strategy ETF"})[e]||`${e} Bitcoin Fund`}function f(e){let t=e.replace(/[,\s]/g,"").match(/([\d.]+)([kKmM])?/);if(t){let e=parseFloat(t[1]),r=t[2]?"k"===t[2].toLowerCase()?1e3:1e6:1;return e*r}return 0}function m(e){let t=e.replace(/[,\s]/g,"").match(/([\d.]+)([kKmMbB])?/);if(t){let e=parseFloat(t[1]),r=1;if(t[2]){let e=t[2].toLowerCase();"k"===e?r=1e3:"m"===e?r=1e6:"b"===e&&(r=1e9)}return e*r}return 0}async function g(e,t){return Promise.all(e.map(async e=>{try{let r=await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${e.ticker}`,{next:{revalidate:300}});if(r.ok){let a=await r.json(),i=a.chart?.result?.[0]?.meta?.regularMarketPrice;if(i&&e.sharesOutstanding>0){let r=e.btcHeld/e.sharesOutstanding,a=r*t;return{ticker:e.ticker,name:e.name,btcHeld:e.btcHeld,sharesOutstanding:e.sharesOutstanding,btcPerShare:r,price:i,premiumDiscount:a>0?(i-a)/a*100:0}}}}catch(t){console.warn(`Failed to fetch price for ${e.ticker}:`,t)}return{ticker:e.ticker,name:e.name,btcHeld:e.btcHeld,sharesOutstanding:e.sharesOutstanding,btcPerShare:e.sharesOutstanding>0?e.btcHeld/e.sharesOutstanding:0,price:0,premiumDiscount:0}}))}a()}catch(e){a(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(498));module.exports=a})();