"use strict";(()=>{var e={};e.id=623,e.ids=[623],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},295:e=>{e.exports=import("cheerio")},8910:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var n=r(9303),o=r(8716),i=r(670),s=r(2356),c=e([s]);s=(c.then?(await c)():c)[0];let u=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/companies/route",pathname:"/api/companies",filename:"route",bundlePath:"app/api/companies/route"},resolvedPagePath:"/Users/davidbryan/Dropbox/Opace-Sales-Marketing/BitcoinBagger/src/app/api/companies/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=u,h="/api/companies/route";function l(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}a()}catch(e){a(e)}})},2356:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>s,dynamic:()=>h});var n=r(7070),o=r(295),i=e([o]);o=(i.then?(await i)():i)[0];let h="force-dynamic";async function s(e){try{let e=await c();if(!e)return n.NextResponse.json({error:"Unable to fetch Bitcoin price. Please try again later."},{status:503});let[t,r]=await Promise.all([l(),u()]);if(!t||0===t.length)return n.NextResponse.json({error:"Unable to fetch Bitcoin treasury data. Please try again later."},{status:503});let a=await m(t,r,e);return n.NextResponse.json(a,{headers:{"Cache-Control":"public, s-maxage=300, stale-while-revalidate=600"}})}catch(e){return console.error("Error fetching companies data:",e),n.NextResponse.json({error:"Unable to fetch live company data. Please try again later."},{status:503})}}async function c(){try{let e=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd",{next:{revalidate:300},headers:{"User-Agent":"BitcoinBagger/1.0"}});if(!e.ok)throw Error(`CoinGecko API error: ${e.status}`);let t=await e.json();return t.bitcoin?.usd||null}catch(e){return console.error("Failed to fetch Bitcoin price:",e),null}}async function l(){try{let e=await fetch("https://bitcointreasuries.net/",{headers:{"User-Agent":"BitcoinBagger/1.0"},next:{revalidate:3600}});if(!e.ok)throw Error(`BitcoinTreasuries.net error: ${e.status}`);let t=await e.text();return function(e){let t=o.load(e),r=[];return t("table tbody tr").each((e,a)=>{let n=t(a).find("td");if(n.length>=4){let e=n.eq(0).text().trim(),t=function(e){let t=e.match(/\(([A-Z]{2,5})\)/)||e.match(/^([A-Z]{2,5})$/);return t?t[1]:null}(e),a=n.eq(1).text().trim(),o=function(e){let t=e.replace(/[,\s]/g,"").match(/([\d.]+)([kK])?/);if(t){let e=parseFloat(t[1]),r=t[2]?1e3:1;return e*r}return 0}(a);t&&o>0&&r.push({ticker:t,name:e.replace(/\s*\([A-Z]{2,5}\)/,"").trim(),btcHeld:o,businessModel:n.eq(2)?.text().trim()||"",btcRole:n.eq(3)?.text().trim()||""})}}),r.slice(0,30)}(t)}catch(e){return console.error("Failed to fetch Bitcoin treasury data:",e),null}}async function u(){let e=new Map;return await Promise.all(["MSTR","MARA","TSLA","RIOT","CLSK","COIN","HUT","GLXY","BITF","CORZ"].map(async t=>{try{let[r,a]=await Promise.all([p(t),d(t)]);(r||a)&&e.set(t,{...r,...a})}catch(e){console.warn(`Failed to fetch data for ${t}:`,e)}})),e}async function p(e){try{let t="http://localhost:3000",[r,a]=await Promise.all([fetch(`${t}/api/proxy/iex?symbol=${e}&endpoint=quote`),fetch(`${t}/api/proxy/iex?symbol=${e}&endpoint=stats`)]),n=r.ok?await r.json():null,o=a.ok?await a.json():null;return{marketPrice:n?.latestPrice||0,sharesOutstanding:o?.sharesOutstanding||0,marketCap:n?.marketCap||0}}catch(t){return console.warn(`IEX API error for ${e}:`,t),null}}async function d(e){try{let t=await fetch(`http://localhost:3000/api/proxy/fmp?symbol=${e}&endpoint=income-statement&period=annual&limit=1`);if(!t.ok)throw Error(`FMP API error: ${t.status}`);let r=(await t.json())[0];return{revenue:r?.revenue?r.revenue/1e9:0,netIncome:r?.netIncome?r.netIncome/1e9:0}}catch(t){return console.warn(`FMP API error for ${e}:`,t),null}}async function m(e,t,r){return e.map((e,a)=>{let n=e.btcHeld*r,o=t.get(e.ticker)||{},i=o.marketPrice||0,s=o.sharesOutstanding||0,c=o.revenue||0,l=s>0?(n+1e9*c)/(1e6*s):0;return{ticker:e.ticker,name:e.name,btcHeld:e.btcHeld,btcValue:n,revenue:c,sharesOutstanding:s,marketPrice:i,bsp:l,premium:l>0&&i>0?(i/l-1)*100:0,businessModel:e.businessModel,btcRole:e.btcRole,rank:a+1}})}a()}catch(e){a(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(8910));module.exports=a})();